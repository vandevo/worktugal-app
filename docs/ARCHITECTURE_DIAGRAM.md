# Worktugal Integration Architecture
**Visual guide to how components connect**

---

## ğŸ—ï¸ CORRECT ARCHITECTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER BROWSER                         â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  React Form Component                                â”‚  â”‚
â”‚  â”‚  - Collects user input                               â”‚  â”‚
â”‚  â”‚  - Validates locally                                 â”‚  â”‚
â”‚  â”‚  - Shows loading state                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â”‚ POST /functions/v1/submit-lead         â”‚
â”‚                    â”‚ Content-Type: application/json         â”‚
â”‚                    â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ HTTPS Request
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE PLATFORM                        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Edge Function: submit-lead                          â”‚  â”‚
â”‚  â”‚  - verify_jwt: false (public access)                 â”‚  â”‚
â”‚  â”‚  - Validates request                                 â”‚  â”‚
â”‚  â”‚  - Uses service role key                            â”‚  â”‚
â”‚  â”‚  - Comprehensive logging                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                                                â”‚
â”‚            â”‚ Service Role Auth                              â”‚
â”‚            â”‚                                                â”‚
â”‚            â–¼                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PostgreSQL Database                                 â”‚  â”‚
â”‚  â”‚  - Table: leads_accounting                           â”‚  â”‚
â”‚  â”‚  - RLS enabled (security in depth)                   â”‚  â”‚
â”‚  â”‚  - Service role bypasses RLS                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Database Insert Success
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               EXTERNAL WEBHOOK (Make.com)                   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Make.com Scenario                                   â”‚  â”‚
â”‚  â”‚  - Receives lead data                                â”‚  â”‚
â”‚  â”‚  - Sends welcome email                               â”‚  â”‚
â”‚  â”‚  - Updates Airtable                                  â”‚  â”‚
â”‚  â”‚  - Notifies Slack                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âŒ INCORRECT ARCHITECTURE (What NOT to do)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER BROWSER                         â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  React Form Component                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â”‚ âŒ Direct Supabase Client Call         â”‚
â”‚                    â”‚    (Uses anon key from .env)           â”‚
â”‚                    â”‚    FAILS in development!               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ âŒ Request blocked or fails
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE DATABASE                        â”‚
â”‚                                                             â”‚
â”‚  âŒ Never receives the data                                 â”‚
â”‚  âŒ No insert happens                                       â”‚
â”‚  âŒ No webhook triggered                                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Why this fails:**
- Development environment has special network constraints
- Browser can't directly reach Supabase with provided credentials
- Anon key may not have proper permissions
- No way to trigger webhooks after insert

---

## ğŸ”„ REQUEST/RESPONSE FLOW

### Step 1: User Submits Form
```
Browser â†’ Edge Function
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Request:
POST /functions/v1/submit-lead
Content-Type: application/json

{
  "name": "John Doe",
  "email": "john@example.com",
  "country": "Portugal",
  "main_need": "NIF setup",
  "urgency": "This week",
  "consent": true
}
```

### Step 2: Edge Function Processes
```
Edge Function Processing
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. âœ… Validate required fields
2. âœ… Initialize Supabase client (service role)
3. âœ… Insert into database
4. âœ… Trigger Make.com webhook
5. âœ… Return success response
```

### Step 3: Database Insert
```
Supabase Database
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

INSERT INTO leads_accounting (
  name, email, country, main_need,
  urgency, consent, source, status
) VALUES (
  'John Doe', 'john@example.com', 'Portugal',
  'NIF setup', 'This week', true,
  'accounting_early_access', 'new'
) RETURNING *;

Result: { id: 123, created_at: '2025-10-03T...', ... }
```

### Step 4: Webhook Trigger
```
Make.com Webhook
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

POST https://hook.eu2.make.com/xxx
Content-Type: application/json

{
  "lead_id": 123,
  "name": "John Doe",
  "email": "john@example.com",
  "country": "Portugal",
  "main_need": "NIF setup",
  "urgency": "This week",
  "created_at": "2025-10-03T...",
  "timestamp": "2025-10-03T..."
}
```

### Step 5: Response to Browser
```
Edge Function â†’ Browser
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Response:
HTTP 200 OK
Content-Type: application/json

{
  "success": true,
  "data": {
    "id": 123,
    "created_at": "2025-10-03T...",
    "name": "John Doe",
    "email": "john@example.com",
    ...
  }
}
```

---

## ğŸ” AUTHENTICATION FLOW

### Public Forms (verify_jwt: false)
```
Browser                  Edge Function              Database
  â”‚                           â”‚                         â”‚
  â”‚â”€â”€â”€â”€ POST /submit-lead â”€â”€â”€>â”‚                         â”‚
  â”‚     (no auth header)      â”‚                         â”‚
  â”‚                           â”‚                         â”‚
  â”‚                           â”‚â”€ Service Role Key â”€â”€â”€â”€â”€>â”‚
  â”‚                           â”‚   (from env vars)       â”‚
  â”‚                           â”‚                         â”‚
  â”‚                           â”‚<â”€â”€â”€â”€ Data saved â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                           â”‚                         â”‚
  â”‚<â”€â”€â”€ Success response â”€â”€â”€â”€â”€â”‚                         â”‚
```

### Protected Forms (verify_jwt: true)
```
Browser                  Edge Function              Database
  â”‚                           â”‚                         â”‚
  â”‚â”€â”€â”€â”€ POST /submit â”€â”€â”€â”€â”€â”€â”€>â”‚                         â”‚
  â”‚     Authorization:        â”‚                         â”‚
  â”‚     Bearer <jwt-token>    â”‚                         â”‚
  â”‚                           â”‚                         â”‚
  â”‚                      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                    â”‚
  â”‚                      â”‚ Verify  â”‚                    â”‚
  â”‚                      â”‚ JWT     â”‚                    â”‚
  â”‚                      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â”‚
  â”‚                           â”‚                         â”‚
  â”‚                           â”‚â”€ Service Role Key â”€â”€â”€â”€â”€>â”‚
  â”‚                           â”‚   + user context        â”‚
  â”‚                           â”‚                         â”‚
  â”‚                           â”‚<â”€â”€â”€â”€ Data saved â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                           â”‚                         â”‚
  â”‚<â”€â”€â”€ Success response â”€â”€â”€â”€â”€â”‚                         â”‚
```

---

## ğŸ› ï¸ CORS FLOW

### Preflight Request (OPTIONS)
```
Browser                          Edge Function
  â”‚                                   â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€ OPTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚  Access-Control-Request-Method    â”‚
  â”‚  Access-Control-Request-Headers   â”‚
  â”‚                                   â”‚
  â”‚                              â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
  â”‚                              â”‚ Return  â”‚
  â”‚                              â”‚ CORS    â”‚
  â”‚                              â”‚ Headers â”‚
  â”‚                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
  â”‚                                   â”‚
  â”‚<â”€â”€â”€â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚  Access-Control-Allow-Origin: *   â”‚
  â”‚  Access-Control-Allow-Methods     â”‚
  â”‚  Access-Control-Allow-Headers     â”‚
  â”‚                                   â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚  (Actual request)                 â”‚
```

### Actual Request (POST)
```
Browser                          Edge Function
  â”‚                                   â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€ POST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚  Content-Type: application/json   â”‚
  â”‚  { form data }                    â”‚
  â”‚                                   â”‚
  â”‚                              â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
  â”‚                              â”‚ Process â”‚
  â”‚                              â”‚ Request â”‚
  â”‚                              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
  â”‚                                   â”‚
  â”‚<â”€â”€â”€â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚  Access-Control-Allow-Origin: *   â”‚
  â”‚  Content-Type: application/json   â”‚
  â”‚  { success: true, data: {...} }   â”‚
```

---

## ğŸ“Š DATA FLOW DIAGRAM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser    â”‚
â”‚   Form       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. User submits
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚
â”‚   Validation â”‚â”€â”€â”€â”€ 2. Client-side checks
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 3. POST request
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Edge Functionâ”‚
â”‚   Gateway    â”‚â”€â”€â”€â”€ 4. Server validation
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 5. Service role auth
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Database   â”‚
â”‚    Insert    â”‚â”€â”€â”€â”€ 6. Save to PostgreSQL
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 7. Insert success
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Webhook    â”‚
â”‚   Trigger    â”‚â”€â”€â”€â”€ 8. Notify Make.com
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 9. Success response
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser    â”‚
â”‚   Success    â”‚â”€â”€â”€â”€ 10. Show confirmation
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” ERROR HANDLING FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ERROR SCENARIOS                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 1: Validation Error
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Browser â†’ Edge Function
          â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Validate    â”‚â”€â”€â”€â”€ Missing field?
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ YES
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Return 400  â”‚â”€â”€â”€â”€ "Missing required fields"
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Scenario 2: Database Error
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Edge Function â†’ Database
                â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Insert      â”‚â”€â”€â”€â”€ Constraint violation?
          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ YES
                â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Return 500  â”‚â”€â”€â”€â”€ "Failed to save lead"
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Scenario 3: Webhook Fails (Non-Fatal)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Database â†’ Webhook
          â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ POST        â”‚â”€â”€â”€â”€ Make.com down?
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ ERROR
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Log warning â”‚â”€â”€â”€â”€ Continue anyway
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Return 200  â”‚â”€â”€â”€â”€ "Success" (data saved)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ COMPONENT RESPONSIBILITIES

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  COMPONENT ROLES                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

React Form Component
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Collect user input
âœ… Client-side validation
âœ… Loading states
âœ… Error messages
âœ… Success redirects
âŒ Database access
âŒ Webhook triggers
âŒ Service role keys


Edge Function
â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Server-side validation
âœ… Database operations
âœ… Webhook triggers
âœ… Error handling
âœ… Logging
âŒ UI rendering
âŒ State management


Supabase Database
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Data persistence
âœ… Data integrity
âœ… RLS security
âœ… Indexes
âŒ Business logic
âŒ Email sending
âŒ External webhooks


Make.com Webhook
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… Email automation
âœ… CRM updates
âœ… Notifications
âœ… Data enrichment
âŒ Data validation
âŒ Data storage
```

---

## ğŸ“ˆ SCALING CONSIDERATIONS

```
Current: Simple Flow
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Browser â†’ Edge Function â†’ Database â†’ Webhook
         [Single point]


Future: Queue-Based Flow
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Browser â†’ Edge Function â†’ Database
                          â†“
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ Queue  â”‚
                     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                          â†“
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ Worker â”‚ â†’ Webhooks
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Benefits:
- More reliable webhook delivery
- Retry logic
- Better error tracking
- Reduced latency for user
```

---

## ğŸ”§ DEVELOPMENT VS PRODUCTION

```
Development Environment
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser (localhost:5173) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Special routing
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Edge Function (Supabase) â”‚
â”‚ - Has database access    â”‚
â”‚ - Has service role key   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Production Environment
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser (worktugal.com)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ Direct HTTPS
             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Edge Function (Supabase) â”‚
â”‚ - Has database access    â”‚
â”‚ - Has service role key   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Same architecture works in both!
```

---

**Use these diagrams when explaining architecture to AI assistants or team members**
