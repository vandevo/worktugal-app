MARKDOWN FORMAT

# Contact Form System Documentation

## Overview
Multi-step contact form with intelligent routing, PMOS filtering, and priority-based lead scoring.

## Form Flow

### Step 1: Purpose Selection
**Question:** "What brings you here?"

**Options:**
1. **Accounting & Tax Help**
   - Description: Connect with English-speaking accountants in Portugal
   - Action: Routes to Step 2 (details form)
   - Priority: Always HIGH

2. **Partnership or Collaboration**
   - Description: Work with us on events, content, or sponsorships
   - Action: Routes to Step 2, then Step 3 (qualification)
   - Priority: Calculated based on budget/timeline

3. **Looking for a Job**
   - Description: Browse our verified remote job board
   - Action: Redirects to https://jobs.worktugal.com (3-second countdown)

4. **Portugal Setup Questions**
   - Description: Visa, NIF, housing, legal setup guidance
   - Action: Routes to Step 2 (shows guide suggestion banner)
   - Priority: NORMAL

5. **Something Else**
   - Description: General inquiry or feedback
   - Action: Routes to Step 2
   - Priority: NORMAL

---

### Step 2: Your Details
**Conditional Fields Based on Purpose**

**Universal Fields (All purposes):**
- **Full Name*** (required)
  - Min: 2 characters
  - Placeholder: "John Doe"

- **Email*** (required)
  - Validation: Valid email format
  - Placeholder: "john@example.com"

- **Message*** (required)
  - Min: 10 characters
  - Max: 500 characters
  - Rows: 4
  - Dynamic label based on purpose:
    - Partnership: "What would you like to collaborate on?"
    - Accounting: "Briefly describe your accounting/tax situation"
    - Info: "What do you need help with?"
    - Other: "How can we help?"

**Conditional Fields (Partnership + Accounting only):**
- **Company/Project** (optional)
  - Placeholder: "Your company name"

- **Website or LinkedIn** (optional)
  - Validation: Must be valid URL if provided
  - Placeholder: "https://example.com"

**Special UI Elements:**
- Info purpose shows banner: "Most questions are answered in our free guides" with link to worktugal.com

**Navigation:**
- Back: Returns to Step 1
- Next: 
  - Partnership → Goes to Step 3
  - All others → Submits form directly

---

### Step 3: Partnership Qualification (PMOS Filter)
**Only shown for Partnership purpose**

**Question 1: Budget***
"Do you have a budget for this collaboration?"

Options:
- Yes (€200 - €499) → value: "200-499"
- Yes (€500 - €999) → value: "500-999"
- Yes (€1,000+) → value: "1000+"
- Not yet / Still exploring → value: "not_yet"

**Question 2: Timeline***
"When would you like to start?"

Options:
- This month → value: "this_month"
- Within 3 months → value: "3_months"
- Later / Flexible → value: "later"

**Navigation:**
- Back: Returns to Step 2
- Send Request: Submits form

---

## Priority Calculation Logic

### HIGH Priority
1. **All accounting requests** (purpose = "accounting")
2. **Partnership with budget €500+** (purpose = "partnership" AND budget_range IN ["500-999", "1000+"])

### NORMAL Priority
1. **Partnership with €200-499 budget starting this month** (purpose = "partnership" AND budget_range = "200-499" AND timeline = "this_month")
2. **Info requests** (purpose = "info")
3. **Other requests** (purpose = "other")

### LOW Priority
1. **Partnership without budget** (purpose = "partnership" AND budget_range IN ["not_yet", "exploring"])

---

## Database Schema

### Table: `contact_requests`

```sql
Columns:
- id (UUID, primary key, auto-generated)
- created_at (TIMESTAMPTZ, default now())
- purpose (TEXT, required) 
  → CHECK: 'accounting' | 'partnership' | 'job' | 'info' | 'other'
- full_name (TEXT, required)
- email (TEXT, required)
- company_name (TEXT, optional)
- website_url (TEXT, optional)
- message (TEXT, optional)
- budget_range (TEXT, optional)
  → CHECK: '200-499' | '500-999' | '1000+' | 'not_yet' | 'exploring'
- timeline (TEXT, optional)
  → CHECK: 'this_month' | '3_months' | 'later' | 'flexible'
- status (TEXT, default 'new')
  → CHECK: 'new' | 'reviewed' | 'replied' | 'converted' | 'archived'
- priority (TEXT, default 'normal')
  → CHECK: 'high' | 'normal' | 'low'
- notes (TEXT, optional) - Admin private notes
- webhook_sent (BOOLEAN, default false)
- webhook_sent_at (TIMESTAMPTZ, optional)
- replied_at (TIMESTAMPTZ, optional)

Indexes:
- idx_contact_purpose ON purpose
- idx_contact_status ON status
- idx_contact_priority ON priority
- idx_contact_created ON created_at DESC
- idx_contact_email ON email
Security (RLS)
INSERT: Anyone (anonymous + authenticated) can submit
SELECT: Only admins can view
UPDATE: Only admins can update
DELETE: Only admins can delete
Success Page
Route: /contact/success?purpose={purpose}&budget={budget_range}

Displays:

Confirmation message
Expected response time based on priority
Next steps
Call-to-action based on purpose
Webhook Integration
Trigger: On successful form submission

Endpoint: VITE_MAKECOM_WEBHOOK_URL (environment variable)

Payload:


{
  "id": "uuid",
  "purpose": "partnership",
  "full_name": "John Doe",
  "email": "john@example.com",
  "company_name": "Acme Corp",
  "website_url": "https://acme.com",
  "message": "Let's collaborate...",
  "budget_range": "1000+",
  "timeline": "this_month",
  "priority": "high",
  "created_at": "2025-01-15T10:30:00Z"
}
Tracking:

Sets webhook_sent = true
Records webhook_sent_at timestamp
Silently fails if webhook URL not configured
Current Status: Completed ✓
3-step form with intelligent routing
Purpose-based field conditionals
PMOS filtering for partnerships
Priority-based lead scoring
Supabase database integration
Make.com webhook integration
Admin dashboard for request management
Mobile-responsive design


---

## JSON FORMAT

```json
{
  "contact_form": {
    "version": "1.0",
    "description": "Multi-step contact form with intelligent routing and PMOS filtering",
    
    "steps": [
      {
        "step": 1,
        "name": "purpose",
        "title": "What brings you here?",
        "options": [
          {
            "value": "accounting",
            "label": "Accounting & Tax Help",
            "description": "Connect with English-speaking accountants in Portugal",
            "icon": "Briefcase",
            "action": "goto_step_2",
            "priority": "high",
            "shows_qualification": false
          },
          {
            "value": "partnership",
            "label": "Partnership or Collaboration",
            "description": "Work with us on events, content, or sponsorships",
            "icon": "Users",
            "action": "goto_step_2_then_3",
            "priority": "calculated",
            "shows_qualification": true
          },
          {
            "value": "job",
            "label": "Looking for a Job",
            "description": "Browse our verified remote job board",
            "icon": "Building",
            "action": "redirect_external",
            "redirect_url": "https://jobs.worktugal.com",
            "redirect_delay_ms": 3000,
            "priority": null
          },
          {
            "value": "info",
            "label": "Portugal Setup Questions",
            "description": "Visa, NIF, housing, legal setup guidance",
            "icon": "BookOpen",
            "action": "goto_step_2",
            "priority": "normal",
            "shows_qualification": false,
            "shows_banner": true,
            "banner_message": "Most questions are answered in our free guides",
            "banner_link": "https://worktugal.com"
          },
          {
            "value": "other",
            "label": "Something Else",
            "description": "General inquiry or feedback",
            "icon": "MessageCircle",
            "action": "goto_step_2",
            "priority": "normal",
            "shows_qualification": false
          }
        ]
      },
      {
        "step": 2,
        "name": "details",
        "title": "Tell us about you",
        "fields": [
          {
            "name": "full_name",
            "label": "Full Name",
            "type": "text",
            "required": true,
            "validation": {
              "min_length": 2,
              "error_message": "Name must be at least 2 characters"
            },
            "placeholder": "John Doe",
            "shows_for": ["all"]
          },
          {
            "name": "email",
            "label": "Email",
            "type": "email",
            "required": true,
            "validation": {
              "format": "email",
              "error_message": "Please enter a valid email"
            },
            "placeholder": "john@example.com",
            "shows_for": ["all"]
          },
          {
            "name": "company_name",
            "label": "Company/Project",
            "type": "text",
            "required": false,
            "placeholder": "Your company name",
            "shows_for": ["partnership", "accounting"]
          },
          {
            "name": "website_url",
            "label": "Website or LinkedIn",
            "type": "url",
            "required": false,
            "validation": {
              "format": "url",
              "error_message": "Please enter a valid URL"
            },
            "placeholder": "https://example.com",
            "shows_for": ["partnership", "accounting"]
          },
          {
            "name": "message",
            "label_dynamic": {
              "partnership": "What would you like to collaborate on?",
              "accounting": "Briefly describe your accounting/tax situation",
              "info": "What do you need help with?",
              "default": "How can we help?"
            },
            "type": "textarea",
            "required": true,
            "rows": 4,
            "validation": {
              "min_length": 10,
              "max_length": 500,
              "error_message": "Please provide at least 10 characters"
            },
            "placeholder": "Tell us more about your needs...",
            "shows_for": ["all"]
          }
        ],
        "navigation": {
          "back": "goto_step_1",
          "next": {
            "partnership": "goto_step_3",
            "default": "submit_form"
          }
        }
      },
      {
        "step": 3,
        "name": "qualification",
        "title": "Partnership Details",
        "shows_for": ["partnership"],
        "fields": [
          {
            "name": "budget_range",
            "label": "Do you have a budget for this collaboration?",
            "type": "radio",
            "required": true,
            "options": [
              {
                "value": "200-499",
                "label": "Yes (€200 - €499)"
              },
              {
                "value": "500-999",
                "label": "Yes (€500 - €999)"
              },
              {
                "value": "1000+",
                "label": "Yes (€1,000+)"
              },
              {
                "value": "not_yet",
                "label": "Not yet / Still exploring"
              }
            ]
          },
          {
            "name": "timeline",
            "label": "When would you like to start?",
            "type": "radio",
            "required": true,
            "options": [
              {
                "value": "this_month",
                "label": "This month"
              },
              {
                "value": "3_months",
                "label": "Within 3 months"
              },
              {
                "value": "later",
                "label": "Later / Flexible"
              }
            ]
          }
        ],
        "navigation": {
          "back": "goto_step_2",
          "submit": "submit_form"
        }
      }
    ],
    
    "priority_logic": {
      "high": [
        {
          "condition": "purpose = 'accounting'",
          "description": "All accounting requests"
        },
        {
          "condition": "purpose = 'partnership' AND budget_range IN ['500-999', '1000+']",
          "description": "Partnership with budget €500+"
        }
      ],
      "normal": [
        {
          "condition": "purpose = 'partnership' AND budget_range = '200-499' AND timeline = 'this_month'",
          "description": "Small budget partnership starting immediately"
        },
        {
          "condition": "purpose = 'info'",
          "description": "Info requests"
        },
        {
          "condition": "purpose = 'other'",
          "description": "General inquiries"
        }
      ],
      "low": [
        {
          "condition": "purpose = 'partnership' AND budget_range IN ['not_yet', 'exploring']",
          "description": "Partnership without budget commitment"
        }
      ]
    },
    
    "database_schema": {
      "table": "contact_requests",
      "columns": [
        {"name": "id", "type": "UUID", "primary_key": true, "default": "gen_random_uuid()"},
        {"name": "created_at", "type": "TIMESTAMPTZ", "default": "now()"},
        {"name": "purpose", "type": "TEXT", "required": true, "enum": ["accounting", "partnership", "job", "info", "other"]},
        {"name": "full_name", "type": "TEXT", "required": true},
        {"name": "email", "type": "TEXT", "required": true},
        {"name": "company_name", "type": "TEXT", "required": false},
        {"name": "website_url", "type": "TEXT", "required": false},
        {"name": "message", "type": "TEXT", "required": false},
        {"name": "budget_range", "type": "TEXT", "required": false, "enum": ["200-499", "500-999", "1000+", "not_yet", "exploring"]},
        {"name": "timeline", "type": "TEXT", "required": false, "enum": ["this_month", "3_months", "later", "flexible"]},
        {"name": "status", "type": "TEXT", "default": "new", "enum": ["new", "reviewed", "replied", "converted", "archived"]},
        {"name": "priority", "type": "TEXT", "default": "normal", "enum": ["high", "normal", "low"]},
        {"name": "notes", "type": "TEXT", "required": false},
        {"name": "webhook_sent", "type": "BOOLEAN", "default": false},
        {"name": "webhook_sent_at", "type": "TIMESTAMPTZ", "required": false},
        {"name": "replied_at", "type": "TIMESTAMPTZ", "required": false}
      ],
      "indexes": [
        {"name": "idx_contact_purpose", "columns": ["purpose"]},
        {"name": "idx_contact_status", "columns": ["status"]},
        {"name": "idx_contact_priority", "columns": ["priority"]},
        {"name": "idx_contact_created", "columns": ["created_at DESC"]},
        {"name": "idx_contact_email", "columns": ["email"]}
      ],
      "rls_policies": {
        "insert": "Anyone (anonymous + authenticated)",
        "select": "Admins only",
        "update": "Admins only",
        "delete": "Admins only"
      }
    },
    
    "success_page": {
      "route": "/contact/success",
      "query_params": ["purpose", "budget"],
      "displays": [
        "Confirmation message",
        "Expected response time (priority-based)",
        "Next steps",
        "Purpose-specific CTA"
      ]
    },
    
    "webhook_integration": {
      "trigger": "on_form_submit",
      "endpoint_env_var": "VITE_MAKECOM_WEBHOOK_URL",
      "method": "POST",
      "payload_fields": [
        "id",
        "purpose",
        "full_name",
        "email",
        "company_name",
        "website_url",
        "message",
        "budget_range",
        "timeline",
        "priority",
        "created_at"
      ],
      "tracking": {
        "webhook_sent": true,
        "webhook_sent_at": "timestamp"
      },
      "error_handling": "silent_fail"
    },
    
    "status": "completed",
    "components": [
      "ContactPage.tsx",
      "ContactSuccess.tsx",
      "contacts.ts (lib)",
      "ContactRequestsManager.tsx (admin)"
    ]
  }
}
You can now copy either format (or both) and paste them into ChatGPT to give it full context of your current contact form implementation!